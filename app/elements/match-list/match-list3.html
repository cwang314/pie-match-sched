<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../match-listing/match-listing.html">
<script src="../../scripts/jquery-2.2.2.min.js"></script>

<dom-module id="match-list">
  <template>
    <style>
      ul {
        list-style: none;
        padding: 20px;
      }
      li + li {
        border-top: solid 1px #666;
      }
    </style>
    <ul>

      <template is="dom-repeat" items="{{matches}}">
        <li>
          <match-listing name="{{item.name}}" email="{{item.email}}" img="{{item.img}}"></match-listing>
        </li>
      </template>
    </ul>
  </template>
  <script>
    Polymer({
      is: "match-list",
      properties: {
        matches: {
          type: Array,
          notify: true,
          reflectToAttribute: true
        }
      },
      ready: function() {
        var matches1 = [
          {
            name: "Scott",
            email: "scott@gmail.com",
            img: "https://randomuser.me/api/portraits/thumb/men/10.jpg"
          },
          {
            name: "Tim",
            email: "tim@gmail.com",
            img: "https://randomuser.me/api/portraits/thumb/men/5.jpg"
          },
        ];

        matches1.push({ name: "Bob", email: "bob@gmail.com", img: "https://randomuser.me/api/portraits/thumb/men/2.jpg" });

        // this.matches = this.matches1;  // For some reason, the view only loads the inital state of the array. So this assignment is to put the 'initial state' after the items are pushed into it, so that the pushed items actually load.
        var xmlhttp = new XMLHttpRequest();
        var url = "https://spreadsheets.google.com/feeds/list/1sS_1lnoimrSNXpUduBsPu3ydLvFEQBooG393O-WKhxc/od6/public/basic?alt=json";


        var hi = function(xmlhttp, matches) {
          return function() {
          if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
            var myArr = JSON.parse(xmlhttp.responseText);

            //Actual sorting of Google Sheet
            // console.log(myArr['feed']['entry'][0]['title']['$t']);
            // console.log(myArr['feed']['entry'][0]['content']['$t']);
            var entries = myArr['feed']['entry'];
            for (i = 0; i < entries.length; i++) {

              teamNumber = entries[i]['title']['$t'];
              teamName = entries[i]['content']['$t'];

              matches1.push({
                name: teamNumber,
                email: teamName,
                img: "https://randomuser.me/api/portraits/thumb/men/5.jpg"
              });
            }

            var matchBinding = function(matches) {
              matches = matches1;
              console.log(matches);
            };
            matchBinding(matches);
            console.log(this);

          }
        };
        };
xmlhttp.onreadystatechange = hi(xmlhttp, this.matches);
        xmlhttp.open("GET", url, true);
        xmlhttp.send();
        setTimeout(function() {console.log(this.matches);}, 3000);

      }
    });


  </script>
</dom-module>
