<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../team-listing/team-listing.html">
<script src="../../scripts/jquery-2.2.2.min.js"></script>

<dom-module id="team-list">
  <template>
  <style>
  ul {
    list-style: none;
    padding: 0;
  }
  li + li {
    border-top: solid 1px #BDBDBD;
  }
  </style>
  <ul>

    <template is="dom-repeat" items="{{matches}}">
      <li>
        <team-listing name="{{item.name}}" email="{{item.email}}" img="{{item.img}}"></team-listing>
      </li>
    </template>
  </ul>
</template>
<script>
Polymer({
  is: "team-list",
  properties: {
    matches: {
      type: Array,
      notify: true,
      reflectToAttribute: true
    }
  },
  ready: function() {
    this.matches = []

    var xmlhttp = new XMLHttpRequest();
    var url = "https://spreadsheets.google.com/feeds/list/1sS_1lnoimrSNXpUduBsPu3ydLvFEQBooG393O-WKhxc/od6/public/basic?alt=json";

    var update = function(xmlhttp, context) {
      return function() {
        if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
          var myArr = JSON.parse(xmlhttp.responseText);
          var entries = myArr['feed']['entry'];

          for (i = 0; i < entries.length; i++) {
            teamNumber = entries[i]['title']['$t'];
            startIndex = 10
            endIndex = 0
            content = entries[i]['content']['$t'];
            for (x = 0; x < 50; x++) {
              console.log(content.substring(x, x+1));
              if (content.substring(x, x+1) == ',') {
                endIndex = x;




            teamName = content.substring(startIndex, endIndex);
            imgLink = content.substring(endIndex+10);
            context.push('matches', {
              name: teamNumber,
              email: teamName,
              img: imgLink,
            });
            break;
          }
          }
        }
        }
      };
    };

    xmlhttp.onreadystatechange = update(xmlhttp, this);
    xmlhttp.open("GET", url, true);
    xmlhttp.send();
  }
});


</script>
</dom-module>
